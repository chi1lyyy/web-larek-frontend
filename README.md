# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

"Веб-ларек" - это интернет-магазин, в котором пользователи могут оформить покупку товаров с доставкой на дом. Для получения данных о товарах и для передачи данных заказа использовано API.

Интерфейс приложения содержит главную страницу, на которой отображается каталог товаров. При клике на карточку товара на главной странице открывается модальное окно с детальной информацией о товаре, реализованное компонентом **ProductView**. На главной странице также присутствует иконка корзины с счетчиком товаров, добавленных туда. При клике на иконку корзины на главной странице открывается модальное окно со списком товаров, добавленных в корзину, реализованное компонентом **CartCounter**.

При открытии модального окна с товаром отображается детальная информация о товаре и появляется возможность добавить товар в корзину нажатием на кнопку "Купить". При добавлении товара в корзину модальное окно закрывается, обновляется счетчик товаров в корзине на главной странице. При открытии карточки товара, уже добавленного в корзину, кнопка "Купить" становится кнопкой "Удалить", при клике на которую товар удаляется из корзины, закрывается модальное окно и обновляется счетччик товаров в корзине на главной странице.

При открытии корзины (**CartView**) отображается список товаров, добавленных в корзину. Когда товаров нет в корзине, кнопка оформления заказа заблокирована. Когда товары в корзине есть товары, считается их общая стоимость, появляется возможность оформить заказ.

При нажатии на кнопку "Оформить" в корзине открывается модальное окно заказа (**OrderView**), в котором можно выбрать способ оплаты и ввести адрес доставки. Поле ввода адреса валидируется: пока оно не заполнено невозможно продолжить оформление заказа (т.е. нажать на кнопку "далее"). При корректном заполнении данных кнопка "далее" разблокируется.

При нажатии на кнопку "далее" в окне заказа открывается модальное окно ввода данных информации о покупателе (**ClientView**). В этом окне необходимо заполнить поля ввода email и номера телефона. При корректном заполнении данных разблокируется кнопка "оплатить".

При нажатии на кнопку оплаты в модальном окне ввода данных о покупателе открывается модальное окно успешного оформления заказа (**SuccessModal**), сообщающее пользователю об успешном оформлении заказа, корзина очищается.



## Основные типы данных
Основные типы данных реализованы интерфейсами:
  **IAPIProducts** - данные о списке товаров, которые приходят от сервера, **IProduct** - данные об одном конкретном товаре, которые приходят от сервера при запросе товара по его id, 
  **IOrderData** - данные о заказе, которые отправляются на сервер.

## Компоненты

Архитектура проекта реализована моделью MVP, компоненты реализации проекта можно разделить на три слоя:

1. Слой данных (Model). Отвечает за хранение даннымх в приложении. 

<!-- Состоит из классов **APIService**, **Cart**, **Order**. -->

2. Слой отображения (View). Отвечает за отображение данных. 

<!-- Включает в себя **Page**, **ModalWindow** (общая структура модальных окон), **ProductView**, **CartView**, **OrderView**, **ClientView**, **SuccessModal** -->

3. Презентер (Presenter). Отвечает за взаимодействие между слоями и логику приложения. Обрабатывает действия пользователя на странице (во View) и передает данные (в Model) с помощью брокера событий **EventEmitter**.

В проекте реализованы базовые классы **Api**, **Events**, **Model<T>**, **Component<T>**.

### Базовые классы
- **Api** - базовый класс для работы с Api приложения и выполнения get/post запросов на сервер и обработки ответов. Содержит свойства baseUrl: string, options: RequestInit. Конструктор принимает эти свойства на вход, устанавливает базовый URL и настройки запроса на сервер. 
  Метод  handleResponse принимает объект типа response и возвращает промис. В случае получения успешного ответа от сервера преобразовывает его в объект, в случае ошибки возвращает статус ответа. 
  Метод get(uri: string) возвращает обработанный ответ от сервера
  post(uri, data, method) — выполняет POST/PUT/DELETE запрос по URI с переданными данными ив озвращает обработанный ответ от сервера.

- **EventEmitter** - базовый класс для работы с событиями в приложении. реализован с помощью паттерна Observer. Содержит свойство _events: Map<EventName, Set<Subscriber>>, хранящее название зарегистрированных событий и набор функций-обработчиков этого события. Конструктор инициализирует пустое свойство _events. Методы:
  on/off, принимают название события и функцию-коллбэк, устанавливют/снимают переданный обработчик на событие. 
  emit принимает название событие и опционально данные и генерирует событие с переданным именем, onAll принимает коллбэк и подписывает обработчик на все события, сохраненные в _events. 
  offAll сбрасывает все события и обработчики (создает новый пустой объект _events).
  trigger принимает название события и контекст. Создает и возвращает функцию-триггер, которая при вызове генерирует событие с указанным именем (eventName) и данными.

- **Model<T>** - абстрактный базовый класс, на основе которого создаются классы модели данных. Позволяет уведомлять об изменениях модели данных через события. Не имеет собственных свойств, в конструктор передаются данные и события, инициализирующие модель данных.
  Метод emitChanges принимает название события и объект с данными, которые передаются в презентер при срабатывании события.

- **Component<T>** - абстрактный базовый класс, на основе которого создаются классы слоя отображения. Содержит общие методы для работы с DOM, необходим для вынесения общей логики отображения данных в отдельный класс для избежания дублирования кода.
Конструктор принимает элемент, в который будет вставляться разметка.
Методы:
toggleClass принимает элемент, у которого нужно переключить класс, название класса, которое нужно добавить/удалить и опциональный параметр force, позволяющий принудительно устанавливать класс. Предназначен для управления классами элементов, если предполагается возможность изменения его состояния.
setText принимает элемент, у которого нужно  установить текстовое содержимое и значение, которое нужно отобразить. Необходим для динамического отображения текстовых данных.
setDisabled принимает элемент, которому нужно установить параметр disabled и значение true/false для управления состоянием.
setHidden принимает элемент, который нужно скрыть. Скрывает элемент.
setVisible принимает элемент, который нужно показать. Необходим для отображения элементов, которые были скрыты.
setImage принимает элемент изображения, ссылку с изображением и альтернативный текст. Устанавливает src и alt для тега img. Предназначен для динамического отображения картинок.
render принимает данные, которые необходимо отобразить (вставить в корневой элемент, переданный классу при создании экземпляра) и возвращает родительский элемент с вставленными компонентами.

Для получения данных о товарах используется API. Для работы с сервером и получение, хранение и изменение данных в приложении реализован класс **APIService**, который наследуется от базового класса **Api**. Отвечает за получение данных о товарах с сервера и передачу данных заказа на сервер. Свойства: наследует свойства и конструктор базового класса. Методы: getProducts(): Promise<IAPIProducts> возвращает промис с данными всех товаров, getProductItem(id): Promise<IProduct> - промис конкретного товара по его id, submitOrder(orderData): Promise<void> выполняет post-запрос для отправки данных заказа на сервер.


### Слой данных
- 
- Класс **Cart** хранит данные о корзине товаров. Имеет свойства items: IProduct[], total: number, в конструкторе инициализируется пустой массив добавленных в корзину товаров и общая (нулевая) сумма заказа. Методы:
  addItem(product). Добавляет товар в корзину.
  removeItem(id). Удаляет товар из корзины.
  getItems(). Возвращает текущий список товаров в корзине.
  countTotal(). Считает общую сумму товаров в корзине.
  clearCart(). Очищает корзину после отправки данных на сервер.
  countProducts(). Считает общее количество товаров в корзине (для счетчика)

- **Order** собирает данные о заказе для передачи данных на сервер. Имплиментирует интерфейс **IOrder**. Содержит свойства интерфейса. В конструкторе инициализируется пустой заказ. Методы:
  setPayment, setEmail, setPhone, setAddress, setCartData - устанавливают данные заказа.
  validate() - проверяет корректность заполнения данных.

### Слой отображения

- **CatalogView** отвечает за отображение каталога товаров. Получает данные о товарах через событие из **App**. Создает карточки из шаблона и вставляет их в разметку.
  Содержит свойства gallery и cardTemplate. В конструкторе находятся элементы разметки для галереи и для шаблона карточек. Устанавливается слушатель события обновления каталога. Имеет методы:
  createCard(product), создающий копии карточек и устанавливающий в них данные товаров. Также в методе создания устанавливается обработчик клика на карточку, при котором создается событие для дальнейшего открытия модального окна карточки.
  render(products), вставляющий карточки в разметку.

- **CartCounter** отвечает за отображение счетчика товаров в корзине. Содержит свойство cartCounter, в конструкторе выполняется поиск элемента в разметке, устанавливается слушатель события изменения количества товаров в корзине. Метод updateCartAmount слушает событие из **App** об изменении товаров в корзине и обновляет счетчик товаров.

- **ModalWindow** реализует общую логику работы модальных окон на странице. Выполняет открытие/закрытие модальных окон и принимает контент для отображения.
  Имеет свойства:
  modalElement: Корневой элемент модального окна в DOM, closeButton: Кнопка "Закрыть" внутри модального окна, content: Контейнер для контента.

  Конструктор принимает селектор модального окна, инициализирует свойства класса и устанавливает слушатели событий.
  Имеет методы
  open(), close(). Открывают/закрывают модальные окна, добавляя/удаляя класс '.modal_active'.
  render(content). Вставляет в модальное окно переданный контент.
  handleClose(event). Обрабатывает клик на оверлей.

- **ProductView**. Отвечает за отображение карточки товара.
  Имеет свойства cardImage, cardCategory, cardTitle, cardText, cardPrice и cardButton.
  Конструктор принимает элемент карточки , устанавливает свойства экземпляра класса(выполняется поиск элементов с соответсвующими классами в разметке), устанавливается слушатель события клика на кнопку "В корзину".
  Имеет методы:
  changeButton, менюящий текст на кнопке карточки товара в случае, если товар есть в корзине.
  render(product) заполняет карточку товара данными.

- **CartView**. Отвечает за отображение корзины. Имеет свойства basketList, totalPrice, orderButton.
  В конструкторе выполняется поиск элементов разметки и устанавливается слушатель события нажатия на кнопку оформления заказа.
  Метод render отрисовывает элементы корзины и общую стоимость товаров в корзине, блокирует кнопку оформления заказа, если стоимость товаров в корзине 0,
  Метод createCartItem создает строку списка товара в корзине.
  Метод для изменения totalPrice?

- **OrderView**. Отвечает за отображение окна заказа и сбор данных от пользователя. Свойства: paymentButtons, addressInput, nextButton.
  В конструкторе выполняется поиск элементов разметки и устанавливаются слушатели событий.
  Метод handlePaymentSelection генерирует событие выбора способа оплаты и добавляет выбранной кнопке активный класс. handleAddressInput обрабатывает ввод адреса доставки, генерирует событие ввода адреса.
  toggleNextButton управляет кнопкой "далее" (добавляет класс 'button_active', если выбран способ оплаты и введен адрес доставки).

- **ClientView**. Отвечает за сбор данных, введенных пользователем. Содержит свойства emailInput, phoneInput, payButton. В конструкторе выполняется поиск элементов разметки и устанавливаются слушатели событий.
  Метод handleInputs генерирует событие ввода данных пользователем для передачи данных. Метод render очищает форму. togglePayButton управляет кнопкой "оплатить". Метод viewTotal отображает стоимость оплаченного заказа.

- **SuccessView**. Отображает информацию об успешной оплате заказа, показывает сумму списанных средств. Свойства totalPrice, closeButton и modalWindow. В конструкторе выполняется поиск динамичных элеметов окна, устанавливается слушатель события нажатия на кнопку.

### Слой взаимодействия

- **EventEmitter** в классической реализации содержит свойство events, хранящее зарегистрированные события. методами on/off устанавливается/снимается обработчик на событие. метод emitрегистрирует событие, onAll/offAll слушиются все события/сбрасываются все обработчики.

- Класс **App** хранит текущее состояние приложения, управляет изменениями и с помощью брокера событий уведомляет View/Model об изменениях. Имеет свойства: apiService, cart, order, catalogView, cartCounter, modalWindow, cartView, orderView, clientView, successView. Конструктор инициализирует все компоненты и подписывается на события:
События в модели данных: 
  cart: updated - 
  order: updated

События в отображении:
  <!-- modalWindow: open/close - открытие/закрытие модального окна. -->?
  product: open - открытие карточки товара.
  product: addToCart/removeFromCart - добавление/удаление товара в корзину.
  cart: open - открытие корзины (нажатие на кнопку корзины на главной страницы).
  cart: removeProduct - удаление товара из корзины (нажатие на кнопку удаления товара в списке товаров корзины).
  cart: toOrder - переход к оформлению заказа (нажатие на кнопку оформления в корзине).
  order: selectPayment - выбор способа оплаты (нажатие на кнопку способа оплаты).
  order: selectDeliveryAddress - ввод адреса доставки.
  order: nextButton - переход к вводу данных пользователя (нажатие на кнопку "далее" в окне **OrderView**).
  client: setEmail - ввод почты.
  client: setPhone - ввод телефона.
  client: proceedPayment - переход к окну оплаты (нажатие на кнопку оплаты).
  success: open/close - отрытие/закрытие модального окна, сообщающего об успешной оплате.
  
  setCatalog. Сообщает View об установке списка товаров, полученных с сервера.
 
 
  updateCart. Обновляет корзину и счетчик товаров.
  openOrderView. Открывает форму заказа.
  setPaymentMethod. Устанавливает способ оплаты.
  setDeliveryAddress. Устанавливает адрес доставки.
  openClientView. Открывает форму данных о покупателе
  setEmail. Устанавливает телефон клиента.
  setPhone. Устанавливает телефон клиента.
  showSuccessModal. Открывает модальное окно успешной оплаты.
  openCartView. 
  submitOrder. Отправляет заказ на сервер.

## Взаимодействие компонентов

После изменения данных в модели, модель генерирует событие, чтобы уведомить через **App** уведомить компонент отображения о необходимости обновления. (**App** подписывается на события, сгенерированные в слое данных и слое отображения). Например, когда пользователь кникает на кнопку добавления товара в корзину, отображение карточки **ProductView** генерирует событие. **App** получает уведомление о событии  и вызывает метод addItem класса **Cart**. **Cart** меняет данные и генерирует событие изменения данных.После этого **App** получает уведомление о событии и уведомляет **ProductView** по необходимости изменения текста кнопки.
