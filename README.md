# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

"Веб-ларек" - это интернет-магазин, в котором пользователи могут оформить покупку товаров с доставкой на дом. Для получения данных о товарах и для передачи данных заказа использовано API.

Интерфейс приложения содержит главную страницу, на которой отображается каталог товаров. При клике на карточку товара на главной странице открывается модальное окно с детальной информацией о товаре, реализованное компонентом **ProductView**. На главной странице также присутствует иконка корзины с счетчиком товаров, добавленных туда. При клике на иконку корзины на главной странице открывается модальное окно со списком товаров, добавленных в корзину, реализованное компонентом **CartCounter**.

При открытии модального окна с товаром отображается детальная информация о товаре и появляется возможность добавить товар в корзину нажатием на кнопку "Купить". При добавлении товара в корзину модальное окно закрывается, обновляется счетчик товаров в корзине на главной странице. При открытии карточки товара, уже добавленного в корзину, кнопка "Купить" становится кнопкой "Удалить", при клике на которую товар удаляется из корзины, закрывается модальное окно и обновляется счетччик товаров в корзине на главной странице.

При открытии корзины (**CartView**) отображается список товаров, добавленных в корзину. Когда товаров нет в корзине, кнопка оформления заказа заблокирована. Когда товары в корзине есть товары, считается их общая стоимость, появляется возможность оформить заказ.

При нажатии на кнопку "Оформить" в корзине открывается модальное окно заказа (**OrderView**), в котором можно выбрать способ оплаты и ввести адрес доставки. Поле ввода адреса валидируется: пока оно не заполнено невозможно продолжить оформление заказа (т.е. нажать на кнопку "далее"). При корректном заполнении данных кнопка "далее" разблокируется.

При нажатии на кнопку "далее" в окне заказа открывается модальное окно ввода данных информации о покупателе (**ClientView**). В этом окне необходимо заполнить поля ввода email и номера телефона. При корректном заполнении данных разблокируется кнопка "оплатить".

При нажатии на кнопку оплаты в модальном окне ввода данных о покупателе открывается модальное окно успешного оформления заказа (**SuccessModal**), сообщающее пользователю об успешном оформлении заказа, корзина очищается.

## Компоненты

Архитектура проекта реализована моделью MVP, компоненты реализации проекта можно разделить на три слоя:

1. Слой данных. Отвечает за хранение даннымх в приложении. Состоит из классов **APIService**, **Cart**, **Order**.

2. Слой отображения. Отвечает за отображение данных. Включает в себя **ModalWindow** (общая структура модальных окон), **ProductView**, **CartView**, **OrderView**, **ClientView**, **SuccessModal**

3. Слой взаимодействия. Отвечает за взаимодействие между слоями и логику приложения. Обрабатывает действия пользователя на странице и передает данные с помощью брокера событий **EventEmitter** и класса **App**.

### Слой данных

- Класс **APIService** наследует базовый класс Api, отвечающий за работу с API приложения. Получает данные о товарах с сервера и передает данные заказа на сервер. В конструкторе принимет базовый URL и настройки. Метод getProducts():IAPIProducts возвращает список всех товаров, getProductItem(id): IProduct - конкретный товар по его id. Методом submitOrder(orderData): IOrderData можно отправить данные заказа на сервер.

- Класс **Cart** хранит данные о корзине товаров. Имеет свойства items: IProduct[], total: number, в конструкторе инициализируется пустой массив добавленных в корзину товаров и общая (нулевая) сумма заказа. Методы:
  addItem(product). Добавляет товар в корзину.
  removeItem(id). Удаляет товар из корзины.
  getItems(). Возвращает текущий список товаров в корзине.
  countTotal(). Считает общую сумму товаров в корзине.
  clearCart(). Очищает корзину после отправки данных на сервер.
  countProducts(). Считает общее количество товаров в корзине (для счетчика)

- **Order** собирает данные о заказе для передачи данных на сервер. Имплиментирует интерфейс **IOrder**. Содержит свойства интерфейса. В конструкторе инициализируется пустой заказ. Методы:
  setPayment, setEmail, setPhone, setAddress, setCartData - устанавливают данные заказа.
  validate() - проверяет корректность заполнения данных.

### Слой отображения

- **CatalogView** отвечает за отображение каталога товаров. Получает данные о товарах через событие из **App**. Создает карточки из шаблона и вставляет их в разметку.
  Содержит свойства gallery и cardTemplate. В конструкторе находятся элементы разметки для галереи и для шаблона карточек. Устанавливается слушатель события обновления каталога. Имеет методы:
  createCard(product), создающий копии карточек и устанавливающий в них данные товаров. Также в методе создания устанавливается обработчик клика на карточку, при котором создается событие для дальнейшего открытия модального окна карточки.
  render(products), вставляющий карточки в разметку.

- **CartCounter** отвечает за отображение счетчика товаров в корзине. Содержит свойство cartCounter, в конструкторе выполняется поиск элемента в разметке, устанавливается слушатель события изменения количества товаров в корзине. Метод updateCartAmount слушает событие из **App** об изменении товаров в корзине и обновляет счетчик товаров.

- **ModalWindow** реализует общую логику работы модальных окон на странице. Выполняет открытие/закрытие модальных окон и принимает контент для отображения.
  Имеет свойства:
  modalElement: Корневой элемент модального окна в DOM, closeButton: Кнопка "Закрыть" внутри модального окна, content: Контейнер для контента.

  Конструктор принимает селектор модального окна, инициализирует свойства класса и устанавливает слушатели событий.
  Имеет методы
  open(), close(). Открывают/закрывают модальные окна, добавляя/удаляя класс '.modal_active'.
  render(content). Вставляет в модальное окно переданный контент.
  handleClose(event). Обрабатывает клик на оверлей.

- **ProductView**. Отвечает за отображение карточки товара.
  Имеет свойства cardImage, cardCategory, cardTitle, cardText, cardPrice и cardButton.
  Конструктор принимает элемент карточки , устанавливает свойства экземпляра класса(выполняется поиск элементов с соответсвующими классами в разметке), устанавливается слушатель события клика на кнопку "В корзину".
  Имеет методы:
  changeButton, менюящий текст на кнопке карточки товара в случае, если товар есть в корзине.
  render(product) заполняет карточку товара данными.

- **CartView**. Отвечает за отображение корзины. Имеет свойства basketList, totalPrice, orderButton.
  В конструкторе выполняется поиск элементов разметки и устанавливается слушатель события нажатия на кнопку оформления заказа.
  Метод render отрисовывает элементы корзины и общую стоимость товаров в корзине, блокирует кнопку оформления заказа, если стоимость товаров в корзине 0,
  Метод createCartItem создает строку списка товара в корзине.
  Метод для изменения totalPrice?

- **OrderView**. Отвечает за отображение окна заказа и сбор данных от пользователя. Свойства: paymentButtons, addressInput, nextButton.
  В конструкторе выполняется поиск элементов разметки и устанавливаются слушатели событий.
  Метод handlePaymentSelection генерирует событие выбора способа оплаты и добавляет выбранной кнопке активный класс. handleAddressInput обрабатывает ввод адреса доставки, генерирует событие ввода адреса.
  toggleNextButton управляет кнопкой "далее" (добавляет класс 'button_active', если выбран способ оплаты и введен адрес доставки).

- **ClientView**. Отвечает за сбор данных, введенных пользователем. Содержит свойства emailInput, phoneInput, payButton. В конструкторе выполняется поиск элементов разметки и устанавливаются слушатели событий.
  Метод handleInputs генерирует событие ввода данных пользователем для передачи данных. Метод render очищает форму. togglePayButton управляет кнопкой "оплатить". Метод viewTotal отображает стоимость оплаченного заказа.

- **SuccessView**. Отображает информацию об успешной оплате заказа, показывает сумму списанных средств. Свойства totalPrice, closeButton и modalWindow. В конструкторе выполняется поиск динамичных элеметов окна, устанавливается слушатель события нажатия на кнопку.

### Слой взаимодействия

- **EventEmitter** в классической реализации содержит свойство events, хранящее зарегистрированные события. методами on/off устанавливается/снимается обработчик на событие. метод emitрегистрирует событие, onAll/offAll слушиются все события/сбрасываются все обработчики.

- Класс **App** хранит текущее состояние приложения, управляет изменениями и с помощью брокера событий уведомляет View/Model об изменениях. Имеет свойства: apiService, cart, order, catalogView, cartCounter, cartView, orderView, clientView, successView. Конструктор инициализирует все компоненты и подписывается на события.
  методы:
  setCatalog. Сообщает View об установке списка товаров, полученных с сервера.
  openProductView.
  addToCart. Вызывает метод cart.addItem/cart.removeItem и сообщает View об обновлении корзины.
  updateCart. Обновляет корзину и счетчик товаров.
  openOrderView. Открывает форму заказа.
  setPaymentMethod. Устанавливает способ оплаты.
  setDeliveryAddress. Устанавливает адрес доставки.
  openClientView. Открывает форму данных о покупателе
  setEmail. Устанавливает телефон клиента.
  setPhone. Устанавливает телефон клиента.
  showSuccessModal. Открывает модальное окно успешной оплаты.
  openCartView. Открывает модальное окно корзины.
  submitOrder. Отправляет заказ на сервер.

## Взаимодействие компонентов

После изменения данных в модели, **App** генерирует событие, чтобы уведомить компонент отображения о необходимости обновления. Например, когда пользователь добавляет товар в корзину, в отображении карточки **ProductView** срабатывает событие клика на кнопку. **App** реагирует на событие клика и вызывает метод addItem класса **Cart**. После этого в **App** генерируется событие изменения данных, при срабатывании которого в **ProductView** меняется текст кнопки.
